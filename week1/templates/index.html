<!DOCTYPE html> 
<!-- html이라고 선언 -->
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>방명록-메인</title>
</head>
<body>
    <h1>방명록</h1>
    <!-- 검색 폼 -->
    <section>
        <h2>검색</h2>
        <form method="get" action="/search">
        <!-- 폼 데이터를 url쿼리스트링으로 전송하고 폼 제출시 브라우져가 /search로 요청을 보냄 -->
        <!-- flask에서는 request.args.get('q')로 이 값을 읽음 -->
            <input type="text" name="q" placeholder="검색어"/>
            <button type="submit">검색</button>
            <!-- get방식으로 /search에 전달해서 서버쪽에서 검색 결과를 보여주도록 함 -->
        </form>
    </section>
    <section>
        <h2>작성</h2>
        <form method = 'post' action = '/write'>
            <!-- method = 'post': 폼 데이터를 http요청 본문(body)에 담아 전송. 보통 쓰기/수정/삭제 같은 동작에 사용 -->
             <!-- action = '/write'Flask 쪽 @app.route("/write", methods=["POST"])로 연결되어 request.form.get("name")/request.form.get("body")로 읽힘. -->

            <input type = 'text' name="name" placeholder = '이름' required/>
            <!-- required는 브라우저가 제출 전에 해주는 간단한 검사 -->
             <!-- 빈 입력이면 브라우저가 사용자에게 알리고 제출을 막아 빈 폼을 보내는 걸 방지 -->
              <!-- 그러나 DevTools로 required속성을 제거할 수 있음. 혹은 curl같은 도구로 임의의 post요청을 보낼 수 잇음. -->
            <br/>
            <textarea name = 'body' placeholder="메시지" rows = '4' required></textarea>
            <br/>
            <button type = 'submit'>등록</button>


        </form>
    </section>

    <section>
        <h2>전체 방명록</h2>
        <ul>
            {%for m in messages%}
            <!-- jinja2제어문. Flask가 render_template("index.html", messages=rows)로 보낸 messages(파이썬리스트/쿼리 결과)를 순회함 -->
             <!-- m은 각 반복에서 항목(여기서는 DB의 한 행; m.name, m.body, m.created_at)같은 필드를 가짐 -->
                <li>
                    <strong>{{m.name}}</strong>({{m.created_at}})<br>
                    <!-- {{m.created_at}}:작성 시각 (서버에서 가져온 문자열)을 보여줌 -->
                    <div>{{m.body|safe}}</div>
                 <!-- !!!@@@@@@@@ 여기서 stored xss가 일어남@@@!!! body를 그대로 랜더링해버림.. -->
                  <!-- safe필터는 jinja2의 자동 이스케이프를 무시하고 그 값을 그대로 html에 삽입 -->
                   <!-- 사용자가 <script></script>같은 악성 코드를 body에 저장하면 이 줄이 실행될 때 브라우저가 그걸 진짜 실행해버림 -->

                </li>  
            {%else%}
                <li>아직 글이 없습니다.</li>
            {% endfor %}
            <!-- 반복 끝 -->
        </ul>
    </section>
</body>
</html>
